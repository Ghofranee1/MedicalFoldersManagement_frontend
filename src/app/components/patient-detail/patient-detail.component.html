<div class="patient-detail-container">
    <div class="detail-header">
        <h2>Détails du Patient</h2>
        <button class="close-btn" (click)="onClose()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="patient-info-section">
        <div class="patient-main-info">
            <div class="patient-photo" *ngIf="patient.photo">
                <img [src]="patient.photo" [alt]="patient.nomFr + ' ' + patient.prenomFr">
            </div>
            <div class="patient-photo placeholder" *ngIf="!patient.photo">
                <i class="fas fa-user"></i>
            </div>

            <div class="patient-details">
                <h3>{{ patient.nomFr }} {{ patient.prenomFr }}</h3>
                <p class="arabic-name" *ngIf="patient.nomAr">{{ patient.nomAr }} {{ patient.prenomAr }}</p>

                <div class="patient-badges">
                    <span class="badge badge-vip" *ngIf="patient.statutVip">VIP</span>
                    <span class="badge badge-permanent" *ngIf="patient.statutPermenant">Permanent</span>
                    <span class="badge badge-confidential" *ngIf="patient.isConfidential">Confidentiel</span>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <label>IPP:</label>
                        <span>{{ patient.ipp }}</span>
                    </div>
                    <div class="info-item">
                        <label>Date de naissance:</label>
                        <span>{{ patient.dateNaissance | date:'dd/MM/yyyy' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Âge:</label>
                        <span>{{ getPatientAge() }} ans</span>
                    </div>
                    <div class="info-item">
                        <label>Sexe:</label>
                        <span>{{ patient.sexe }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.numeroCIN">
                        <label>CIN:</label>
                        <span>{{ patient.numeroCIN }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.lieuNaissance">
                        <label>Lieu de naissance:</label>
                        <span>{{ patient.lieuNaissance }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.phone1">
                        <label>Téléphone 1:</label>
                        <span>{{ patient.phone1 }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.phone2">
                        <label>Téléphone 2:</label>
                        <span>{{ patient.phone2 }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.email">
                        <label>Email:</label>
                        <span>{{ patient.email }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.adresseFr">
                        <label>Adresse:</label>
                        <span>{{ patient.adresseFr }}</span>
                    </div>
                    <div class="info-item" *ngIf="patient.gouvernoratHabitat">
                        <label>Gouvernorat:</label>
                        <span>{{ patient.gouvernoratHabitat }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dossiers-section">
        <h3>Dossiers Médicaux ({{ dossiers.length }})</h3>

        <div *ngIf="loading" class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            Chargement des dossiers...
        </div>

        <div *ngIf="error" class="error-message">
            {{ error }}
        </div>

        <div *ngIf="!loading && !error" class="dossiers-grid">
            <div *ngFor="let dossier of dossiers" class="dossier-card" (click)="selectDossier(dossier)">
                <div class="dossier-header">
                    <h4>{{ dossier.departement?.libelleFr }}</h4>
                    <span class="dossier-id">ID: {{ dossier.id }}</span>
                </div>
                <div class="dossier-info">
                    <div class="info-row">
                        <span class="label">Date de création:</span>
                        <span class="value">{{ dossier.dateCreation | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Nombre de fichiers:</span>
                        <span class="value">{{ dossier.nombreFichiers || 0 }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="!loading && !error && dossiers.length === 0" class="no-dossiers">
            <i class="fas fa-folder-open"></i>
            <p>Aucun dossier médical trouvé pour ce patient</p>
        </div>
    </div>

    <!-- Dossier Detail Modal -->
    <div *ngIf="selectedDossier" class="dossier-detail-overlay" (click)="closeDossierDetail()">
        <div class="dossier-detail-panel" (click)="$event.stopPropagation()">
            <app-dossier-detail [dossier]="selectedDossier!" (close)="closeDossierDetail()"></app-dossier-detail>
        </div>
    </div>
</div>